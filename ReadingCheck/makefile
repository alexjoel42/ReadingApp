# ======================
# ReadingApp Build System
# ======================

.PHONY: setup install build start test clean help

# Environment
NODE_ENV ?= development
APP_PORT ?= 3000

# ===========
# Main Targets
# ===========

setup: ## Install all dependencies and verify environment
	@echo "üöÄ Setting up ReadingApp..."
	@make verify-node
	@make install
	@make verify

install: ## Install Node.js dependencies
	@echo "üì¶ Installing dependencies..."
	@npm install
	npm install

build: ## Build the application
	@echo "üî® Building application..."
	npm run build

start: ## Start the development server
	@echo "üí° Starting ReadingApp..."
	npm start

test: ## Run tests
	@echo "üß™ Running tests..."
	npm test

clean: ## Remove node_modules and build artifacts (cross-platform)
	@echo "üßπ Cleaning up..."
ifeq ($(OS),Windows_NT)
	@powershell -Command "Get-ChildItem -Directory -Recurse -Force -Include 'node_modules','build' | Remove-Item -Recurse -Force -ErrorAction SilentlyContinue"
else
	@find . -type d \( -name "node_modules" -o -name "build" \) -exec rm -rf {} + 2>/dev/null || true
endif

# ==============
# Helper Targets
# ==============

verify-node: ## Verify Node.js version
	@echo "üîç Checking Node.js version..."
	@node -v | grep -q "^v16\|^v18\|^v20" || (echo "‚ùå Node.js 16.x, 18.x or 20.x required" && exit 1)

verify: ## Verify installation
	@echo "‚úÖ Verifying installation..."
	npm ls --depth=0

help: ## Show this help
	@echo "üìñ Available commands:"
	@grep -E '^[a-zA-Z_-]+:.*?## .*$$' $(MAKEFILE_LIST) | awk 'BEGIN {FS = ":.*?## "}; {printf "\033[36m%-15s\033[0m %s\n", $$1, $$2}'

# =================
# Shortcut Aliases
# =================
run: start ## Alias for start
dev: start ## Alias for start